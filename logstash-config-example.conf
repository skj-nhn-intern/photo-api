# Logstash 설정 예시
# Photo API 로그를 수집하여 Elasticsearch로 전송

input {
  file {
    path => "/var/log/photo-api/*.log"
    start_position => "beginning"
    sincedb_path => "/var/lib/logstash/sincedb/photo-api"
    codec => "json"  # JSON 형식인 경우
    # codec => "plain"  # 일반 텍스트인 경우
    type => "photo-api"
    tags => ["photo-api", "api-server"]
  }
}

filter {
  if [type] == "photo-api" {
    # 로그 파싱 (필요에 따라 수정)
    grok {
      match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:message}" }
    }
    
    # 날짜 파싱
    date {
      match => [ "timestamp", "yyyy-MM-dd HH:mm:ss.SSS" ]
    }
    
    # 필드 추가
    mutate {
      add_field => {
        "service" => "photo-api"
        "environment" => "%{ENVIRONMENT}"
      }
    }
  }
}

output {
  # Elasticsearch로 전송
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "photo-api-%{+YYYY.MM.dd}"
  }
  
  # 또는 다른 출력 (예: 파일, 다른 Elasticsearch 클러스터 등)
  # file {
  #   path => "/var/log/logstash/photo-api-processed.log"
  # }
  
  # 디버깅용 stdout (개발 환경에서만 사용)
  # stdout {
  #   codec => rubydebug
  # }
}
