sequenceDiagram
    participant Client as 클라이언트
    participant API as Photo API
    participant DB as DB
    participant CDN as NHN CDN
    participant Storage as Object Storage

    Client->>+API: GET /photos/{photo_id}/image<br/>Header: Authorization: Bearer {JWT}
    API->>API: JWT 검증
    API->>DB: get_photo_by_id(photo_id, user_id)
    DB-->>API: Photo (storage_path 등)
    alt CDN 설정됨 (nhn_cdn_domain, nhn_cdn_app_key)
        API->>CDN: generate_auth_token_url(storage_path)<br/>POST CDN API → singlePathToken
        CDN-->>API: CDN URL + token
        API-->>Client: 302 Redirect: https://{cdn_domain}/{path}?token={token}
        Client->>CDN: GET CDN URL (token 쿼리)
        CDN->>Storage: 원본 미캐시 시 GET
        CDN-->>Client: 200 + 이미지
    else CDN 미설정 또는 토큰 실패
        API->>Storage: download_file(storage_path) — Swift GET
        Storage-->>API: file bytes
        API-->>-Client: 200 + Content-Type + 이미지 바이트
    end
